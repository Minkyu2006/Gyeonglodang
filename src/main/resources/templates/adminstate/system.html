<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate ="~{layout/admindefault}">

<head>
    <script type="text/javascript">

        $(function() {
            dataInfo();
            realTime();
            AutoStart();
			operlationGet();
        })

		// 글자제한함수
		function numberMaxLength(e){
			if(e.value.length > e.maxLength){
				e.value = e.value.slice(0, e.maxLength);
			}
		}

        // 데이터 받아오는 함수
        function dataInfo() {
            $.ajax({
                url: '/adminhomedata/adminMenuDataInfo',
                type: 'post',
                cache: false,
                error: function () {
                    alert('데이터받기 실패');
                },
                success: function (res) {

                    // 에어컨셋팅
                    if(res.data.aircondition !== '') {
                        airconditionCheck(res.data.aircondition.r_data);
                    }

                    // 조명셋팅
                    if(res.data.lightData !== ''){
                        lightCheck(res.data.lightData.r_data)
                    }

                    // 공기청정기셋팅
                    if(res.data.airpurification !== '') {
                        airpurificationCheck(res.data.airpurification.r_data);
                    }

                    // 가전전원셋팅
                    if(res.data.electricDate !== ''){
                        electricCheck(res.data.electricDate.r_data);
                    }

                    if(res.data.batteryData !== '') {
                        // 배터리 셋팅
                        var battery = JSON.parse(res.data.batteryData.r_data);
                        console.log('');

                        var batteryLowValue = 100;
                        $.each(battery,function(key, value){
                            if(value!=="" && batteryLowValue>Number(value)){
                                batteryLowValue = Number(value);
                            }
                        });
                        console.log('제일 낮은 battery : ' + batteryLowValue);
                        batteryRefresh(batteryLowValue)
                    }
                }
            });
        }

		// todo 운영정책 데이터 저장하기.
        function operlationPut() {

		}

		// todo 운영정책 데이터 가져오기.
		function operlationGet() {
			var params = {
				value : "http://square.abrain.co.kr:8080/square/operation/commonSetting?system_id=S002"
			};
			$.ajax({
				url: '/apiData/operationGet',
				type: 'post',
				data: params,
				cache: false,
				error: function () {
					alert('데이터받기 실패');
				},
				success: function (res) {

					if (res.data.operationDate !== '') {
						console.log("운영정책 데이터 system_id=S002 : "+res.data.operationDate);
						console.log();
						var operationDate = JSON.parse(res.data.operationDate);
						// console.log("operationDate : "+operationDate);

						$("#opentime1").val(operationDate.data.opentime.substring(0,2));
						$("#opentime2").val(operationDate.data.opentime.substring(3,5));

						$("#closetime1").val(operationDate.data.closetime.substring(0,2));
						$("#closetime2").val(operationDate.data.closetime.substring(3,5));

						$("#dooropentime1").val(operationDate.data.dooropentime.substring(0,2));
						$("#dooropentime2").val(operationDate.data.dooropentime.substring(3,5));

						$("#doorclosetime1").val(operationDate.data.doorclosetime.substring(0,2));
						$("#doorclosetime2").val(operationDate.data.doorclosetime.substring(3,5));

						$("#motiontimer").val(operationDate.data.motiontimer);

						var dayofweek = operationDate.data.dayofweek;
						// console.log("dayofweek : "+dayofweek);
						for(i=0; i<dayofweek.length; i++){
							if(dayofweek.substring(i,i+1)==="1"){
								$("#dayofweek"+i).prop('checked', true);
							}
						}

					}

				}
			});
		}

    </script>
</head>

<body>
<div class="wrap">
    <div class="console">
        <div class="infobox">
            <h2 class="info-title">Manager Mode</h2>
            <div class="datetime">
                <span class="date">2021.01.18 월요일</span>
                <span class="time">am 10:16</span>
            </div>
        </div>
        <div class="iot-buttons">
            <h3>IoT 가전제어</h3>
            <ul>
                <li>
                    <button id="airBtn" class="console-button aircon">에어컨<span>ON</span></button>
                </li>
                <li>
                    <button id="lightBtn" class="console-button light">조명<span>ON</span></button>
                </li>
                <li>
                    <button id="aqBtn" class="console-button airfresher">공기청정기<span>ON</span></button>
                </li>
                <li>
                    <button id="electricBtn" class="console-button electronic">가전 전원<span>ON</span></button>
                </li>
            </ul>
        </div>
        <div class="battery">
            <div class="battery__head">
                <h3 class="battery_title">배터리</h3>
                <span class="battery-percent"></span>
                <a href="/admindashboard/battery" class="battery-link"><img src="/assets/images/btn_setting.png" alt="" /></a>
            </div>
            <div class="battery__contents">
                <div class="battery__progress" data-percent="80">
                    <div class="battery__bar"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="contents">
        <div class="button-list">
            <!-- 장소별 페이지 버튼 리스트 수정 -->
            <ul>
                <li><a href="/admindashboard/" class="back"><img src="/assets/images/icon_back.png" alt="" />뒤로가기</a></li>
            </ul>
        </div>

        <div class="setting">
        	<ul class="setting__list">
        		<li>
        			<h5 class="setting__title">open time</h5>
        			<div class="setting__console">
	        			<input type="number" id="opentime1" class="setting__input-text" placeholder="10" maxlength="2" oninput="numberMaxLength(this);" />
	        			<span>:</span>
	        			<input type="number" id="opentime2" class="setting__input-text" placeholder="00" maxlength="2" oninput="numberMaxLength(this);" />
        			</div>
        		</li>
        		<li>
        			<h5 class="setting__title">close time</h5>
        			<div class="setting__console">
	        			<input type="number" id="closetime1" class="setting__input-text" placeholder="16" maxlength="2" oninput="numberMaxLength(this);" />
	        			<span>:</span>
	        			<input type="number" id="closetime2" class="setting__input-text" placeholder="00" maxlength="2" oninput="numberMaxLength(this);" />
        			</div>
        		</li>
        		<li>
        			<h5 class="setting__title">door open time</h5>
        			<div class="setting__console">
	        			<input type="number" id="dooropentime1" class="setting__input-text" placeholder="09" maxlength="2" oninput="numberMaxLength(this);" />
	        			<span>:</span>
	        			<input type="number" id="dooropentime2" class="setting__input-text" placeholder="30" maxlength="2" oninput="numberMaxLength(this);" />
        			</div>
        		</li>
        		<li>
        			<h5 class="setting__title">door close time</h5>
        			<div class="setting__console">
	        			<input type="number" id="doorclosetime1" class="setting__input-text" placeholder="17" maxlength="2" oninput="numberMaxLength(this);" />
	        			<span>:</span>
	        			<input type="number" id="doorclosetime2" class="setting__input-text" placeholder="00" maxlength="2" oninput="numberMaxLength(this);" />
        			</div>
        		</li>
        		<li>
        			<h5 class="setting__title">day of week</h5>
        			<div class="setting__console">
        				<ul>
        					<li>
	        					<input id="dayofweek0" type="checkbox" class="setting__input-check" />
	        					<label for="dayofweek0" class="setting__label">일</label>
        					</li>
        					<li>
	        					<input id="dayofweek1" type="checkbox" class="setting__input-check" />
	        					<label for="dayofweek1" class="setting__label">월</label>
        					</li>
        					<li>
	        					<input id="dayofweek2" type="checkbox" class="setting__input-check" />
	        					<label for="dayofweek2" class="setting__label">화</label>
        					</li>
        					<li>
	        					<input id="dayofweek3" type="checkbox" class="setting__input-check" />
	        					<label for="dayofweek3" class="setting__label">수</label>
        					</li>
        					<li>
	        					<input id="dayofweek4" type="checkbox" class="setting__input-check" />
	        					<label for="dayofweek4" class="setting__label">목</label>
        					</li>
        					<li>
	        					<input id="dayofweek5" type="checkbox" class="setting__input-check" />
	        					<label for="dayofweek5" class="setting__label">금</label>
        					</li>
							<li>
								<input id="dayofweek6" type="checkbox" class="setting__input-check" />
								<label for="dayofweek6" class="setting__label">토</label>
							</li>
        				</ul>
        			</div>
        		</li>
        		<li>
        			<h5 class="setting__title">motion timer</h5>
        			<div class="setting__console">
	        			<input type="number" id="motiontimer" class="setting__input-text" placeholder="30" maxlength="2" oninput="numberMaxLength(this);" />
        			</div>
        		</li>
        	</ul>
			<button onclick="operlationPut()" class="setting__btn">저장</button>
        </div>
    </div>
</div>
</body>
</html>
